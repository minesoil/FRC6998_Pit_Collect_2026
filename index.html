<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>6998 | 2026 Pit Collect</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS VARIABLES (THEME CONFIGURATION) --- */
        :root {
            --bg-deep: #050505;       /* The darkest background (body) */
            --bg-card: #141419;       /* The background for question cards */
            --accent: #D4AF37;        /* Gold accent color for highlights/buttons */
            --accent-dim: #b89b00;    /* Darker gold for hover states */
            --text-main: #ffffff;     /* White text */
            --text-secondary: #a0a0a0;/* Grey text for subtitles */
            --danger: #ff4444;        /* Red for errors/reset buttons */
            --success: #00C851;       /* Green for success messages */
            --input-bg: #1f1f26;      /* Background color for text boxes */
            --border: rgba(255, 215, 0, 0.2); /* Subtle gold border */
        }

        /* --- GLOBAL RESET --- */
        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            font-family: 'Lexend', sans-serif; 
            -webkit-tap-highlight-color: transparent; /* Removes blue highlight on tap on mobile */
        }
        
        body { 
            background-color: var(--bg-deep); 
            color: var(--text-main); 
            padding-bottom: 100px; /* Adds extra space at bottom so the Next button doesn't cover content */
        }

        /* --- HEADER STYLES --- */
        header {
            background: linear-gradient(180deg, #1a1a20 0%, var(--bg-deep) 100%);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid var(--accent);
            position: sticky; /* Keeps header at the top when scrolling */
            top: 0;
            z-index: 100; /* Ensures header stays on top of other elements */
            box-shadow: 0 4px 20px rgba(0,0,0,0.7);
        }
        header h1 { 
            color: var(--accent); 
            font-weight: 800; 
            letter-spacing: 2px; 
            font-size: 1.4rem; 
            text-transform: uppercase; 
        }
        /* The badge showing how many robots have been scouted */
        .counter-badge {
            position: absolute; top: 20px; right: 20px;
            font-size: 0.75rem; color: var(--accent); border: 1px solid var(--accent);
            padding: 4px 8px; border-radius: 8px; font-weight: 600;
        }

        /* --- LAYOUT & ANIMATION --- */
        .container { max-width: 650px; margin: 0 auto; padding: 20px; }
        
        /* Pages are hidden by default. Only the one with class 'active' is shown */
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        
        /* Simple fade-in animation for smooth page transitions */
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        /* --- CARD STYLES (Question Containers) --- */
        .section-title {
            color: var(--text-secondary); font-size: 0.85rem; font-weight: 700;
            text-transform: uppercase; letter-spacing: 1px; margin: 25px 0 10px 5px;
            border-left: 3px solid var(--accent); padding-left: 10px;
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
        }

        /* --- INPUT FIELD STYLES --- */
        label { display: block; font-size: 0.9rem; margin-bottom: 8px; font-weight: 600; color: var(--text-main); }
        .sub-label { font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 8px; display: block; }

        input[type="text"], input[type="number"], select, textarea {
            width: 100%; padding: 14px; background: var(--input-bg);
            border: 1px solid #333; border-radius: 10px;
            color: white; font-size: 1rem; outline: none; transition: 0.3s;
        }
        /* Glow effect when user clicks into a box */
        input:focus, select:focus, textarea:focus { border-color: var(--accent); box-shadow: 0 0 10px rgba(255, 215, 0, 0.1); }
        
        /* Style for when a bad word is detected */
        .violation { border-color: var(--danger) !important; background: rgba(255, 68, 68, 0.1) !important; }

        /* --- CUSTOM GRID BUTTONS (Checkboxes looking like buttons) --- */
        .grid-select { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); /* Responsive grid */
            gap: 12px; 
            margin-top: 10px; 
        }
        
        /* The container for the checkbox/radio */
        .toggle-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 15px 10px;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            color: var(--text-secondary);
        }
        /* Hide the actual ugly browser checkbox */
        .toggle-btn input { position: absolute; opacity: 0; cursor: pointer; height: 0; width: 0; }
        
        /* Styles applied when the hidden checkbox inside is checked */
        .toggle-btn:has(input:checked) {
            background: rgba(255, 215, 0, 0.15); /* Gold Tint */
            border-color: var(--accent);
            color: var(--accent);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }

        /* --- RANGE SLIDER (For Stability) --- */
        .slider-container { padding: 10px 0; }
        input[type="range"] {
            -webkit-appearance: none; width: 100%; height: 6px; background: #333;
            border-radius: 5px; outline: none; margin-top: 10px;
        }
        /* The round handle on the slider */
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 24px; height: 24px; border-radius: 50%;
            background: var(--accent); cursor: pointer; border: 2px solid #000;
        }

        /* --- NAVIGATION BAR (Bottom) --- */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(10, 10, 10, 0.95); /* Semi-transparent black */
            backdrop-filter: blur(10px); /* Blurs content behind the bar */
            padding: 15px 20px;
            display: flex; gap: 15px;
            border-top: 1px solid #333;
            z-index: 1000;
        }
        .btn {
            flex: 1; padding: 16px; border: none; border-radius: 12px;
            font-size: 1rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
            cursor: pointer; transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.98); } /* Click effect */
        .btn-back { background: #2a2a2a; color: #fff; }
        .btn-next { background: var(--accent); color: #000; }
        
        /* Greyed out Next button when form is invalid */
        .btn-next:disabled { 
            background: #444; 
            color: #888; 
            opacity: 0.7; 
            cursor: not-allowed; 
            box-shadow: none;
        }

        /* --- UTILITY CLASSES --- */
        .team-display { margin-top: 10px; font-size: 0.9rem; font-weight: bold; color: var(--accent); display: inline-block; padding: 5px 10px; background: rgba(255,215,0,0.1); border-radius: 8px; }
        .error-msg { color: var(--danger); font-size: 0.75rem; font-weight: bold; margin-top: 5px; display: none; }
        #qrcode { background: white; padding: 15px; border-radius: 10px; margin: 20px auto; width: fit-content; display: none; }
        
        .profanity-alert {
            background: rgba(255, 68, 68, 0.2);
            border: 1px solid var(--danger);
            color: #ffcccc;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.8rem;
            margin-top: 10px;
            display: none;
            font-weight: bold;
            text-align: center;
        }

        /* For "Other" text inputs that appear conditionally */
        .conditional-input {
            margin-top: 15px;
            display: none;
            animation: fadeIn 0.3s ease;
        }
    </style>
</head>
<body>

<header>
    <h1>6998 | 2026 Pit Collect</h1>
    <div class="counter-badge" id="robotCounter">ROBOTS: 0</div>
</header>

<div class="container">
    <form id="scoutForm">

        <div class="page active" id="page0">
            <div class="section-title">Step 1: Identification</div>
            
            <div class="card">
                <label>Scouter Name (你的名字)</label>
                <input type="text" id="scouterName" placeholder="First & Last Name">
                <div class="error-msg" id="err-name">Invalid Name</div>
                <div class="profanity-alert" id="profanity-name">Please remove inappropriate language.</div>
            </div>

            <div class="card">
                <label>Team Number (隊伍編號)</label>
                <input type="number" id="teamNum" placeholder="e.g. 6998">
                <div id="teamNameDisplay" class="team-display">Waiting for input...</div>
                <div class="error-msg" id="err-team">Unknown or Invalid Team Number</div>
            </div>
        </div>

        <div class="page" id="page1">
            <div class="section-title">Step 2: Robot Specifications</div>

            <div class="card">
                <label>Chassis Type (底盤)</label>
                <select id="chassis">
                    <option value="Swerve">Swerve</option>
                    <option value="Tank">Tank</option>
                    <option value="Mecanum">Mecanum</option>
                    <option value="Other">Other</option>
                </select>
                
                <br><br>
                <label>Robot Weight (機器人重量)</label>
                <span class="sub-label">In Pounds (lbs)</span>
                <input type="number" id="weight" placeholder="125">
                <div class="error-msg" id="err-weight">Max Weight is 135 lbs</div>
                
                <br><br>
                <label>Max Fuel Capacity (最高容量)</label>
                <input type="number" id="capacity" placeholder="e.g. 1">
            </div>

            <div class="section-title">Step 3: Systems</div>

            <div class="card">
                <label>Intake Mechanism (Intake)</label>
                <div class="grid-select">
                    <label class="toggle-btn">
                        <input type="checkbox" name="intake" value="Roller">
                        Roller
                    </label>
                    <label class="toggle-btn">
                        <input type="checkbox" name="intake" value="Pneumatic">
                        Pneumatic
                    </label>
                    <label class="toggle-btn">
                        <input type="checkbox" name="intake" id="intakeOtherTrigger">
                        Other (其他)
                    </label>
                </div>
                <div class="conditional-input" id="intakeOtherBox">
                    <input type="text" id="intakeOtherVal" placeholder="Describe intake type...">
                </div>
            </div>

            <div class="card">
                <label>Vision Hardware (視覺硬體)</label>
                <div class="grid-select">
                    <label class="toggle-btn">
                        <input type="checkbox" name="visionHard" value="Limelight">
                        Limelight
                    </label>
                    <label class="toggle-btn">
                        <input type="checkbox" name="visionHard" value="PhotonCamera">
                        Photon Camera
                    </label>
                     <label class="toggle-btn">
                        <input type="checkbox" name="visionHard" id="visOtherTrigger">
                        Other (其他)
                    </label>
                </div>
                <div class="conditional-input" id="visOtherBox">
                    <input type="text" id="visOtherVal" placeholder="Describe camera/vision...">
                </div>
            </div>

            <div class="card">
                <label>Vision Capabilities (相機功能)</label>
                 <div class="grid-select">
                    <label class="toggle-btn">
                        <input type="checkbox" name="visionSoft" value="ObjDetect">
                        Object Detection
                    </label>
                    <label class="toggle-btn">
                        <input type="checkbox" name="visionSoft" value="AprilTag">
                        AprilTag
                    </label>
                     <label class="toggle-btn">
                        <input type="checkbox" name="visionSoft" id="visSoftOtherTrigger">
                        Other (其他)
                    </label>
                </div>
                <div class="conditional-input" id="visSoftOtherBox">
                    <input type="text" id="visSoftOtherVal" placeholder="Describe vision capabilities...">
                </div>
            </div>

            <div class="card">
                <label>Shooting Capabilities (射球能力)</label>
                <div class="grid-select">
                    <label class="toggle-btn">
                        <input type="checkbox" name="shoot" value="MoveShoot">
                        邊走邊射<br><span style="font-size:0.7em">(Move & Shoot)</span>
                    </label>
                    <label class="toggle-btn">
                        <input type="checkbox" name="shoot" value="IntakeShoot">
                        邊吸邊射<br><span style="font-size:0.7em">(Intake & Shoot)</span>
                    </label>
                </div>
            </div>

            <div class="card">
                <label>Turret Features (砲台)</label>
                <div class="grid-select">
                    <label class="toggle-btn">
                        <input type="checkbox" name="turret" value="Yaw">
                        Yaw (Horizontal)
                    </label>
                    <label class="toggle-btn">
                        <input type="checkbox" name="turret" value="Pitch">
                        Pitch (Vertical)
                    </label>
                </div>
            </div>
        </div>

        <div class="page" id="page2">
            <div class="section-title">Step 4: Autonomous</div>

            <div class="card">
                <label>Starting Location (位子)</label>
                <div class="grid-select">
                    <label class="toggle-btn">
                        <input type="checkbox" name="startPos" value="Left">
                        Left (左)
                    </label>
                    <label class="toggle-btn">
                        <input type="checkbox" name="startPos" value="Center">
                        Center (中)
                    </label>
                    <label class="toggle-btn">
                        <input type="checkbox" name="startPos" value="Right">
                        Right (右)
                    </label>
                </div>

                <br><br>
                <label>Preload Count (Preload 數量)</label>
                <span class="sub-label">Maximum 8</span>
                <input type="number" id="preload" placeholder="0" max="8">
                <div class="error-msg" id="err-preload">Max Preload is 8</div>
            </div>

             <div class="card">
                <label style="display:flex; align-items:center; gap:10px;">
                    <input type="checkbox" id="autoIntake" style="width:25px; height:25px; accent-color:var(--accent);">
                    <span>Auto Intake from Outpost/Depot? (自動階段去吸球)</span>
                </label>
            </div>

            <div class="card">
                <label style="display:flex; align-items:center; gap:10px;">
                    <input type="checkbox" id="autoHang" style="width:25px; height:25px; accent-color:var(--accent);">
                    <span>Auto Hang L1? (自動階段掛L1)</span>
                </label>
            </div>

            <div class="card">
                <label>Total Auto Fuel (Auto 總共顆數)</label>
                <span class="sub-label">Scored during Auto</span>
                <input type="number" id="autoTotal" placeholder="0">
            </div>

            <div class="card">
                <label class="toggle-btn" style="width:100%;">
                    <input type="checkbox" id="crossMid" onchange="toggleTerrainSection()">
                    Cross Midfield (會不會過中場)
                </label>
            </div>

            <div class="card" id="terrainCard" style="display:none;">
                <label>Terrain Navigation (地形)</label>
                <div class="grid-select">
                    <label class="toggle-btn">
                        <input type="checkbox" name="terrain" value="Bump" id="terrainBump" onchange="checkStability()">
                        Bump
                    </label>
                    <label class="toggle-btn">
                        <input type="checkbox" name="terrain" value="Trench">
                        Trench
                    </label>
                </div>

                <div id="stabilityBox" style="margin-top:20px; display:none; border-top:1px solid #333; padding-top:15px;">
                    <label>Bump Stability (過Bump影響)</label>
                    <span class="sub-label">1 (Very Unstable) - 5 (Very Stable)</span>
                    <div style="display:flex; align-items:center; gap:15px;">
                        <span style="font-weight:bold; color:var(--accent); font-size:1.2rem;" id="stableVal">3</span>
                        <input type="range" id="stability" min="1" max="5" value="3" oninput="document.getElementById('stableVal').innerText = this.value">
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="page3">
            <div class="section-title">Step 5: Teleop & Endgame</div>

            <div class="card">
                <label>Climb Capability (吊掛能力)</label>
                <div class="grid-select">
                    <label class="toggle-btn">
                        <input type="checkbox" name="climbLvl" value="L1">
                        L1
                    </label>
                    <label class="toggle-btn">
                        <input type="checkbox" name="climbLvl" value="L2">
                        L2
                    </label>
                    <label class="toggle-btn">
                        <input type="checkbox" name="climbLvl" value="L3">
                        L3
                    </label>
                </div>
            </div>

            <div class="card">
                <label>Climb Position (吊掛位子)</label>
                <div class="grid-select" style="grid-template-columns: repeat(3, 1fr);">
                    <label class="toggle-btn">
                        <input type="checkbox" name="climbPos" value="Left">
                        Left<br>左
                    </label>
                    <label class="toggle-btn">
                        <input type="checkbox" name="climbPos" value="Center">
                        Center<br>中
                    </label>
                    <label class="toggle-btn">
                        <input type="checkbox" name="climbPos" value="Right">
                        Right<br>右
                    </label>
                </div>
                <div class="grid-select" style="margin-top:10px;">
                    <label class="toggle-btn">
                        <input type="checkbox" name="climbPos" value="FarLeft">
                        Far Left Side (左側)
                    </label>
                    <label class="toggle-btn">
                        <input type="checkbox" name="climbPos" value="FarRight">
                        Far Right Side (右側)
                    </label>
                </div>
            </div>

            <div class="card">
                <label>Climb Time (吊掛時間)</label>
                <span class="sub-label">Estimated seconds to climb</span>
                <input type="number" id="climbTime" placeholder="e.g. 5">
            </div>

            <div class="card">
                <label style="display:flex; align-items:center; gap:10px;">
                    <input type="checkbox" id="photosTaken" style="width:25px; height:25px; accent-color:var(--accent);">
                    <span>Photos Taken? (照片全部已拍)</span>
                </label>
            </div>

            <div class="card">
                <label>General Notes (備註)</label>
                <textarea id="notes" rows="4" placeholder="Driver skill, defense, reliability notes..."></textarea>
                <div class="profanity-alert" id="profanity-notes">Please remove inappropriate language.</div>
            </div>
        </div>

        <div class="page" id="page4">
            <div class="section-title">Step 6: Review & Sync</div>
            <div class="card" style="text-align:center;">
                <h2 style="color:var(--accent); margin-bottom:10px;">Ready to Generate</h2>
                <div id="reviewText" style="text-align:left; background:#000; padding:15px; border-radius:10px; margin-bottom:20px; font-size:0.9rem; line-height:1.6; color:#ccc;">
                </div>

                <div id="qrcode"></div>
                
                <button type="button" class="btn btn-next" id="generateBtn" onclick="generateQR()">Generate QR Code</button>
                <br><br>
                <button type="button" class="btn" style="background:var(--danger); color:white; font-size:0.8rem; padding:10px;" onclick="resetForm()">Reset Form</button>
            </div>
        </div>

    </form>
</div>

<div class="nav-bar">
    <button type="button" class="btn btn-back" id="backBtn" onclick="navigate(-1)">Back</button>
    <button type="button" class="btn btn-next" id="nextBtn" onclick="navigate(1)">Next</button>
</div>

<script>
    /* =========================================
       JSON DATA KEY (QR CODE DICTIONARY)
       
       t    : Team Number
       sc   : Scouter Name
       dt   : Drive/Chassis Type
       wt   : Weight (lbs)
       mx   : Max Piece Capacity
       in   : Intake Mechanism (Array/String)
       visH : Vision Hardware (Limelight, etc)
       visS : Vision Software (Tags, Object, etc)
       sht  : Shooting Capability
       tur  : Turret Capability
       
       stL  : Starting Location (Enum)
       pre  : Preload Count
       auInt: Auto Intake (0/1)
       auHng: Auto Hang (0/1)
       at   : Auto Total Pieces Scored
       mid  : Crossed Midfield (1 = Yes, 0 = No)
       ter  : Terrain Type (String list)
       stb  : Stability Rating (1-5)
       
       cLv  : Climb Level (L1, L2, L3)
       cPs  : Climb Position (Left, Right, Center)
       cTm  : Climb Time (seconds)
       ph   : Photos Taken (1 = Yes, 0 = No)
       nt   : Notes
    ========================================= */

    /* --- CONFIGURATION --- */
    // TEAM LIST: You must update this list for every specific competition!
    const TEAM_LIST = {
        364: "Team Fusion",
        456: "Siege Robotics",
        538: "Renaissance Robotics",
        590: "Chahta Warriors",
        1421: "Team CHAOS",
        1912: "Team Combustion",
        1927: "Tempest",
        2221: "FHS Robodawgs",
        2556: "RadioActive Roaches",
        2992: "The S.S. Prometheus",
        3039: "Wildcat Robotics",
        3606: "BearMetal",
        3616: "Team Phenomena",
        3753: "BulahBots!",
        4087: "Voodoo Voltage",
        4107: "Team Storm",
        4336: "Ramageddon Robotics",
        4400: "Cerbotics - Peñoles",
        5045: "SpartaBot",
        5863: "Hypercubed",
        5971: "Raider Robotics Team",
        6184: "C4 (Capital City Chaotic Coders)",
        6706: "Golem",
        6998: "Unipards",
        7094: "Alpha Omega",
        7474: "JXN UNITED",
        8044: "Denham Venom",
        8624: "Sasquatch Robotics",
        8808: "SWLA Tech Pirates",
        9153: "Bearcat Robotics",
        9309: "Metal Mages",
        9405: "KNOS Robotics",
        9503: "EF5 CHAOS",
        9717: "Poultronix",
        9734: "Jasper County Robotics",
        10101: "Critical Hit",
        10217: "Catahoula Blue Dogs",
        10309: "Jayhawks Robotics",
        10661: "Blue Phoenix",
        10929: "Tarpon Robotics",
        10943: "WJH RoboStangs",
        10961: "Hyper Wave",
        11107: "FARMBots",
        11265: "Rockbotics -FRC",
        11287: "Canton Career Center",
        11343: "JPS High School Robotics",
        11345: "Long Beach RoboBearcats"

    };

    // BAD WORDS LIST
    const BAD_WORDS = ["damn", "hell", "shit", "fuck", "bitch", "crap", "ass", "bastard", "dick", "piss", "cock", "pussy", "slut", "whore", "nigger", "fag", "retard", "sex", "nude", "gyatt", "skibidi", "rizz"];
    
    // State Variables
    let currentPage = 0; // Starts at 0 (Step 1)
    
    /* --- LOGIC HANDLERS --- */
    
    // 1. Toggle "Other" text boxes
    function setupOtherToggle(triggerId, boxId) {
        document.getElementById(triggerId).addEventListener('change', function(e) {
            const box = document.getElementById(boxId);
            if(e.target.checked) {
                box.style.display = 'block';
                box.querySelector('input').focus();
            } else {
                box.style.display = 'none';
                box.querySelector('input').value = ''; // Clear input if unchecked
            }
        });
    }

    setupOtherToggle('intakeOtherTrigger', 'intakeOtherBox');
    setupOtherToggle('visOtherTrigger', 'visOtherBox');
    setupOtherToggle('visSoftOtherTrigger', 'visSoftOtherBox');

    // 2. Logic to handle exclusive checkboxes (where needed) - Keep existing exclusive checks if any remain
    document.querySelectorAll('.exclusive-check').forEach(box => {
        box.addEventListener('change', (e) => {
            const group = e.target.dataset.group;
            if(!group) return; 

            if (e.target.checked) {
                document.querySelectorAll(`input[data-group="${group}"]`).forEach(el => { 
                    if(el !== e.target) el.checked = false; 
                });
            }
        });
    });

    // Function to Show/Hide the Terrain Section
    // Triggered when "Cross Midfield" is checked/unchecked
    function toggleTerrainSection() {
        const crossMid = document.getElementById('crossMid').checked;
        const card = document.getElementById('terrainCard');
        
        if(crossMid) {
            card.style.display = 'block'; // Show
        } else {
            card.style.display = 'none'; // Hide
            // Reset terrain inputs when hidden
            document.querySelectorAll('input[name="terrain"]').forEach(cb => cb.checked = false);
            checkStability(); 
        }
    }

    // Function to Show/Hide the Stability Slider
    function checkStability() {
        // If "Bump" specifically is checked, show stability
        const bumpChecked = document.getElementById('terrainBump').checked;
        document.getElementById('stabilityBox').style.display = bumpChecked ? 'block' : 'none';
    }

    // Team Number Lookup Logic
    document.getElementById('teamNum').addEventListener('input', function() {
        const num = this.value;
        const disp = document.getElementById('teamNameDisplay');
        
        if(TEAM_LIST[num]) {
            disp.textContent = "✓ " + TEAM_LIST[num];
            disp.style.color = "#000";
            disp.style.background = "var(--accent)";
        } else {
            disp.textContent = num ? "Unknown Team" : "Waiting for input...";
            disp.style.color = num ? "var(--text-secondary)" : "var(--accent)";
            disp.style.background = "rgba(255,255,255,0.05)";
        }
        updateNavButtons(); // Re-check if we can proceed
    });

    document.getElementById('scouterName').addEventListener('input', updateNavButtons);
    document.getElementById('notes').addEventListener('input', updateNavButtons);
    document.getElementById('weight').addEventListener('input', updateNavButtons);
    document.getElementById('capacity').addEventListener('input', updateNavButtons);
    document.getElementById('preload').addEventListener('input', updateNavButtons);
    document.getElementById('autoTotal').addEventListener('input', updateNavButtons);
    document.getElementById('climbTime').addEventListener('input', updateNavButtons);
    
    // Add listeners to conditional "Other" inputs so validation updates when they type
    document.getElementById('intakeOtherVal').addEventListener('input', updateNavButtons);
    document.getElementById('visOtherVal').addEventListener('input', updateNavButtons);
    document.getElementById('visSoftOtherVal').addEventListener('input', updateNavButtons);

    function containsProfanity(text) {
        if (!text) return false;
        const lower = text.toLowerCase();
        return BAD_WORDS.some(word => lower.includes(word));
    }

    /* --- NAVIGATION & VALIDATION --- */

    function updateNavButtons() {
        const nextBtn = document.getElementById('nextBtn');
        let isValid = true;

        // Validation for Page 0 (ID)
        if (currentPage === 0) {
            const name = document.getElementById('scouterName').value.trim();
            const team = document.getElementById('teamNum').value.trim();
            
            if(containsProfanity(name)) {
                document.getElementById('profanity-name').style.display = 'block';
                document.getElementById('scouterName').classList.add('violation');
                isValid = false;
            } else {
                document.getElementById('profanity-name').style.display = 'none';
                document.getElementById('scouterName').classList.remove('violation');
            }

            if (name.length < 2) isValid = false;

            if (!TEAM_LIST[team]) {
                document.getElementById('err-team').style.display = team ? 'block' : 'none';
                isValid = false;
            } else {
                document.getElementById('err-team').style.display = 'none';
            }
        }
        // Validation for Page 1 (Specs)
        else if (currentPage === 1) {
            const weightVal = document.getElementById('weight').value;
            const capVal = document.getElementById('capacity').value;
            const weight = parseFloat(weightVal);
            
            // Check if fields are empty
            if (weightVal === '' || capVal === '') {
                isValid = false;
            }
            // Check Weight Limit
            else if (weight > 135) {
                document.getElementById('err-weight').style.display = 'block';
                document.getElementById('weight').classList.add('violation');
                isValid = false;
            } else {
                document.getElementById('err-weight').style.display = 'none';
                document.getElementById('weight').classList.remove('violation');
            }

            // Check Conditional "Other" fields
            if(document.getElementById('intakeOtherBox').style.display === 'block' && 
               document.getElementById('intakeOtherVal').value.trim() === '') isValid = false;
               
            if(document.getElementById('visOtherBox').style.display === 'block' && 
               document.getElementById('visOtherVal').value.trim() === '') isValid = false;
               
            if(document.getElementById('visSoftOtherBox').style.display === 'block' && 
               document.getElementById('visSoftOtherVal').value.trim() === '') isValid = false;
        }
        // Validation for Page 2 (Auto)
        else if (currentPage === 2) {
            const preloadVal = document.getElementById('preload').value;
            const autoTotalVal = document.getElementById('autoTotal').value;
            const preload = parseFloat(preloadVal);
            
            // Retrieve Capacity from previous page
            const capacity = parseFloat(document.getElementById('capacity').value) || 0;
            const errPreload = document.getElementById('err-preload');

            // Check Empty
            if (preloadVal === '' || autoTotalVal === '') {
                isValid = false;
            }
            
            // Preload Validation Logic
            if (preload > 8) {
                errPreload.innerText = "Max Preload is 8";
                errPreload.style.display = 'block';
                document.getElementById('preload').classList.add('violation');
                isValid = false;
            } 
            else if (preload > capacity) {
                errPreload.innerText = "Preload count should not be higher than max fuel capacity (" + capacity + ")";
                errPreload.style.display = 'block';
                document.getElementById('preload').classList.add('violation');
                isValid = false;
            } 
            else {
                errPreload.style.display = 'none';
                document.getElementById('preload').classList.remove('violation');
            }
        }
        // Validation for Page 3 (Teleop/Endgame)
        else if (currentPage === 3) {
             const climbTimeVal = document.getElementById('climbTime').value;
             const notes = document.getElementById('notes').value;
             
             // Check Empty Fields (Notes are usually optional, but strict mode: check climbTime)
             if (climbTimeVal === '') isValid = false;

             // Profanity Check
             if(containsProfanity(notes)) {
                document.getElementById('profanity-notes').style.display = 'block';
                document.getElementById('notes').classList.add('violation');
                isValid = false;
             } else {
                document.getElementById('profanity-notes').style.display = 'none';
                document.getElementById('notes').classList.remove('violation');
             }
        }

        nextBtn.disabled = !isValid;
    }

    function navigate(dir) {
        if (dir === 1 && document.getElementById('nextBtn').disabled) return; 

        document.getElementById(`page${currentPage}`).classList.remove('active');
        currentPage += dir;
        document.getElementById(`page${currentPage}`).classList.add('active');
        
        document.getElementById('backBtn').style.visibility = currentPage === 0 ? 'hidden' : 'visible';
        
        if(currentPage === 4) {
            document.getElementById('nextBtn').style.display = 'none';
            prepareReview();
        } else {
            document.getElementById('nextBtn').style.display = 'block';
            updateNavButtons();
        }
        window.scrollTo(0,0);
    }

    /* --- REVIEW & GENERATE --- */
    
    // Helper to get multi-select values string
    function getMultiValues(name, otherId = null) {
        let vals = [];
        document.querySelectorAll(`input[name="${name}"]:checked`).forEach(cb => {
            // If this is the "Other" trigger checkbox, grab text from input instead
            if(otherId && cb.id.includes('Other')) {
                const txt = document.getElementById(otherId).value.trim();
                if(txt) vals.push("Other: " + txt);
            } else {
                vals.push(cb.value);
            }
        });
        return vals.join(' + ');
    }

    function prepareReview() {
        const t = document.getElementById('teamNum').value;
        const name = TEAM_LIST[t] || "Unknown";
        
        let html = `<strong>Team ${t} - ${name}</strong><br>`;
        html += `Scouter: ${document.getElementById('scouterName').value}<br>`;
        html += `<hr style="border-color:#333; margin:5px 0;">`;
        
        // Robot Specs
        html += `Chassis: ${document.getElementById('chassis').value}<br>`;
        html += `Intake: ${getMultiValues('intake', 'intakeOtherVal') || 'None'}<br>`;
        html += `Vision H/W: ${getMultiValues('visionHard', 'visOtherVal') || 'None'}<br>`;
        html += `Vision S/W: ${getMultiValues('visionSoft', 'visSoftOtherVal') || 'None'}<br>`;
        
        // Auto
        html += `Start: ${getMultiValues('startPos') || 'None'}<br>`;
        html += `Auto Intake: ${document.getElementById('autoIntake').checked ? 'Yes' : 'No'}<br>`;
        html += `Auto Hang: ${document.getElementById('autoHang').checked ? 'Yes' : 'No'}<br>`;
        
        // Terrain
        if(document.getElementById('crossMid').checked) {
            html += `Terrain: ${getMultiValues('terrain')}<br>`;
            if(document.getElementById('terrainBump').checked) {
                html += `Stability: ${document.getElementById('stability').value}/5<br>`;
            }
        }
        
        document.getElementById('reviewText').innerHTML = html;
    }

    function generateQR() {
        const teamNum = document.getElementById('teamNum').value;
        
        // Construct Data Object
        const data = {
            t: parseInt(teamNum),
            sc: document.getElementById('scouterName').value,
            dt: document.getElementById('chassis').value,
            wt: document.getElementById('weight').value,
            mx: document.getElementById('capacity').value,
            in: getMultiValues('intake', 'intakeOtherVal'),
            visH: getMultiValues('visionHard', 'visOtherVal'),
            visS: getMultiValues('visionSoft', 'visSoftOtherVal'),
            sht: getMultiValues('shoot'),
            tur: getMultiValues('turret'),
            
            stL: getMultiValues('startPos'),
            pre: document.getElementById('preload').value,
            auInt: document.getElementById('autoIntake').checked ? 1 : 0,
            auHng: document.getElementById('autoHang').checked ? 1 : 0,
            at: document.getElementById('autoTotal').value,
            mid: document.getElementById('crossMid').checked ? 1 : 0,
            ter: getMultiValues('terrain'),
            stb: document.getElementById('stability').value,
            
            cLv: getMultiValues('climbLvl'),
            cPs: getMultiValues('climbPos'),
            cTm: document.getElementById('climbTime').value,
            ph: document.getElementById('photosTaken').checked ? 1 : 0,
            nt: document.getElementById('notes').value
        };

        const jsonStr = JSON.stringify(data);
        
        // Clear previous QR
        document.getElementById('qrcode').innerHTML = "";
        document.getElementById('qrcode').style.display = "block";
        
        // Generate new QR
        new QRCode(document.getElementById("qrcode"), {
            text: jsonStr,
            width: 256,
            height: 256,
            colorDark : "#000000",
            colorLight : "#ffffff",
            correctLevel : QRCode.CorrectLevel.L
        });
        
        document.getElementById('generateBtn').style.display = 'none'; // Prevent double gen
        
        // Update Counter
        const counter = document.getElementById('robotCounter');
        let count = parseInt(counter.innerText.split(': ')[1]) + 1;
        counter.innerText = "ROBOTS: " + count;
    }

    function resetForm() {
        if(confirm("Are you sure you want to clear all form data and return to the start?")) {
            // 1. Reset the actual form inputs
            document.getElementById('scoutForm').reset();
            
            // 2. Hide "Other" inputs that were toggled open
            document.getElementById('intakeOtherBox').style.display = 'none';
            document.getElementById('visOtherBox').style.display = 'none';
            document.getElementById('visSoftOtherBox').style.display = 'none';
            document.getElementById('terrainCard').style.display = 'none';
            document.getElementById('stabilityBox').style.display = 'none';
            
            // 3. Reset Team Name Display & Slider Text
            const disp = document.getElementById('teamNameDisplay');
            disp.textContent = "Waiting for input...";
            disp.style.color = "var(--accent)";
            disp.style.background = "rgba(255,255,255,0.05)";
            document.getElementById('stableVal').innerText = "3";
            
            // 4. Reset Error Messages/Validation Styles
            document.querySelectorAll('.error-msg').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.profanity-alert').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.violation').forEach(el => el.classList.remove('violation'));
            
            // 5. Hide QR Code / Reset Generate Button
            document.getElementById('qrcode').innerHTML = "";
            document.getElementById('qrcode').style.display = "none";
            document.getElementById('generateBtn').style.display = 'inline-block';
            document.getElementById('reviewText').innerHTML = "";

            // 6. Navigate back to Page 0
            document.querySelector('.page.active').classList.remove('active');
            currentPage = 0;
            document.getElementById('page0').classList.add('active');
            
            // 7. Update Navigation Buttons
            document.getElementById('backBtn').style.visibility = 'hidden';
            document.getElementById('nextBtn').style.display = 'block';
            updateNavButtons(); // Will disable Next button because fields are empty
            
            window.scrollTo(0,0);
        }
    }

    // Run validation immediately on load to disable the Next button
    updateNavButtons();
</script>
</body>
</html>
